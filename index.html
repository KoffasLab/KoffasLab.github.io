<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Koffas Lab</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --sage-light: #f0f4f0;
            --sage-medium: #9caf88;
            --sage-dark: #6b8e5a;
            --sage-darker: #4a6741;
            --white: #ffffff;
            --gray-light: #f8f9fa;
            --gray-medium: #6c757d;
            --gray-dark: #343a40;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--gray-dark);
            background-color: var(--white);
            height: 100vh;
            overflow: hidden;
        }

        /* Tab Navigation */
        .tab-container {
            height: 100vh;
            display: flex;
        }

        .tab-sidebar {
            width: 200px;
            background: var(--sage-light);
            padding: 20px 0;
            border-right: 1px solid rgba(107, 142, 90, 0.2);
        }

        .logo {
            padding: 0 20px 30px 20px;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--sage-darker);
            text-align: center;
            border-bottom: 1px solid rgba(107, 142, 90, 0.2);
            margin-bottom: 20px;
        }

        .tab-nav {
            list-style: none;
        }

        .tab-nav li {
            margin-bottom: 5px;
        }

        .tab-nav a {
            display: block;
            padding: 15px 20px;
            text-decoration: none;
            color: var(--gray-dark);
            font-weight: 500;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .tab-nav a:hover {
            background: rgba(107, 142, 90, 0.1);
            color: var(--sage-darker);
        }

        .tab-nav a.active {
            background: var(--white);
            color: var(--sage-darker);
            border-left: 3px solid var(--sage-dark);
            font-weight: 600;
        }

        /* Main Content Area */
        .main-content {
            flex: 1;
            height: 100vh;
            overflow-y: auto;
            overflow-x: hidden;
            background: var(--white);
        }

        .content-wrapper {
            max-width: 1200px;
            padding: 40px 40px 80px 40px;
            height: auto;
            display: flex;
            flex-direction: column;
            margin: 20px auto 0 auto;
            justify-content: flex-start;
        }

        /* Hero Content - Horizontal Layout */
        .hero-content {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
            gap: 3rem;
            margin-bottom: 2rem;
        }

        .hero-text-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            text-align: left;
        }

        .hero-title {
            opacity: 0;
            animation: fadeInUp 1s ease forwards;
            margin-bottom: 2rem;
        }

        .hero-title h1 {
            font-size: 3rem;
            font-weight: 300;
            margin-bottom: 0;
            color: var(--sage-darker);
            line-height: 1.2;
        }

        .hero-title a:hover {
            text-decoration: underline;
            opacity: 0.8;
        }

        /* Network Visualization Container - Larger size */
        .visualization-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: min(600px, 60vh);
            width: min(600px, 95vw);
            max-width: 600px;
            flex-shrink: 0;
            opacity: 0;
            animation: fadeIn 1s ease 0.6s forwards;
            overflow: visible;
            background: transparent;
            position: relative;
            aspect-ratio: 1;
        }

        .visualization-container svg {
            width: 100%;
            height: 100%;
            overflow: visible;
            viewBox: 0 0 500 500;
            preserveAspectRatio: xMidYMid meet;
        }
        
        .protein-node {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .protein-node:hover {
            filter: brightness(1.5);
        }
        
        .connection-line {
            stroke-width: 1.5;
            opacity: 0.5;
            stroke-linecap: round;
        }
        
        .pulse-particle {
            r: 3;
            opacity: 0;
        }
        
        .protein-label {
            font-size: 12px;
            font-weight: bold;
            text-anchor: middle;
            dominant-baseline: central;
            pointer-events: none;
        }
        
        .typing-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            padding: clamp(15px, 3vw, 25px) clamp(20px, 4vw, 35px);
            border-radius: clamp(8px, 2vw, 12px);
            box-shadow: 0 3px 15px rgba(167, 196, 160, 0.2);
            z-index: 10;
            font-family: 'Courier New', monospace;
            font-size: clamp(12px, 3.5vw, 22px);
            font-weight: 900;
            color: #566852;
            text-align: center;
            backdrop-filter: blur(2px);
            white-space: nowrap;
            max-width: 90%;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .cursor {
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .network-iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: transparent;
            display: block;
        }

        /* Fallback content styling */
        .iframe-fallback {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            color: var(--gray-dark);
            font-size: 1.1rem;
            text-align: center;
            padding: 20px;
        }

        .hero-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: flex-start;
            opacity: 0;
            animation: fadeInUp 1s ease 1s forwards;
        }

        .cta-button {
            display: inline-block;
            background: var(--sage-dark);
            color: var(--white);
            padding: 15px 30px;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .cta-button:hover {
            background: var(--sage-darker);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(107, 142, 90, 0.3);
        }

        .cta-button.secondary {
            background: transparent;
            color: var(--sage-dark);
            border: 2px solid var(--sage-dark);
        }

        .cta-button.secondary:hover {
            background: var(--sage-dark);
            color: var(--white);
        }



        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .tab-container {
                flex-direction: column;
                height: auto;
                overflow: visible;
            }
            
            body {
                height: auto;
                overflow: visible;
            }

            .tab-sidebar {
                width: 100%;
                height: auto;
                border-right: none;
                border-bottom: 1px solid rgba(107, 142, 90, 0.2);
            }

            .tab-nav {
                display: flex;
                overflow-x: auto;
                padding: 0 20px;
            }

            .tab-nav li {
                margin-bottom: 0;
                white-space: nowrap;
            }

            .tab-nav a {
                border-left: none;
                border-bottom: 3px solid transparent;
            }

            .tab-nav a.active {
                border-left: none;
                border-bottom: 3px solid var(--sage-dark);
            }

            .main-content {
                height: auto;
                overflow: visible;
            }

            .content-wrapper {
                padding: 20px 15px 40px 15px;
                height: auto;
                margin: 10px auto 0 auto;
            }

            .hero-content {
                flex-direction: column;
                gap: 1.5rem;
                text-align: center;
                align-items: center;
            }

            .hero-text-section {
                align-items: center;
                text-align: center;
            }

            .hero-title h1 {
                font-size: clamp(1.8rem, 5vw, 2.2rem);
            }

            .hero-buttons {
                justify-content: center;
            }

            /* Mobile visualization adjustments */
            .visualization-container {
                height: min(350px, 45vh);
                width: min(350px, 90vw);
                max-width: 350px;
                margin: 0 auto;
            }

            .features-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Extra small screens */
        @media (max-width: 480px) {
            .hero-title h1 {
                font-size: clamp(1.5rem, 6vw, 1.8rem);
            }
            
            .visualization-container {
                height: min(280px, 40vh);
                width: min(280px, 95vw);
                max-width: 280px;
            }
            
            .content-wrapper {
                padding: 15px 10px 30px 10px;
            }
            
            .hero-content {
                gap: 1rem;
            }
        }

        /* Landscape mobile phones and narrow windows */
        @media (max-width: 768px) and (orientation: landscape), (max-width: 900px) and (max-height: 600px) {
            .hero-content {
                flex-direction: row;
                gap: 1rem;
                align-items: center;
            }
            
            .visualization-container {
                height: min(300px, 70vh);
                width: min(300px, 45vw);
                flex-shrink: 0;
            }
            
            .hero-text-section {
                flex: 1;
                min-width: 0;
            }
        }

        /* Very narrow windows (minimized) */
        @media (max-width: 600px) {
            .visualization-container {
                height: min(250px, 35vh);
                width: min(250px, 90vw);
            }
        }
    </style>
</head>
<body>
    <div class="tab-container">
        <!-- Vertical Tab Sidebar -->
        <div class="tab-sidebar">
            <div class="logo">Koffas Lab</div>
            <ul class="tab-nav">
                <li><a href="index.html" class="active">Home</a></li>
                <li><a href="research.html">Research</a></li>
                <li><a href="members.html">Lab Members</a></li>
                <li><a href="publications.html">Publications</a></li>
                <li><a href="gallery.html">Gallery</a></li>
                <li><a href="news.html">News</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>
        </div>

        <!-- Main Content Area -->
        <div class="main-content">
            <div class="content-wrapper">
                <div class="hero-content">
                    <!-- Left side: Text content -->
                    <div class="hero-text-section">
                        <!-- 1. Title First -->
                        <div class="hero-title">
                            <h1>Koffas Research Group<br><span style="font-size: 0.6em; text-align: center; display: block;"><a href="https://cbe.rpi.edu/people/faculty/mattheos-koffas" target="_blank" rel="noopener noreferrer" style="color: inherit; text-decoration: none;">@ Rensselaer Polytechnic Institute</a></span></h1>
                        </div>

                        <!-- 2. Buttons Second -->
                        <div class="hero-buttons">
                            <a href="research.html" class="cta-button">Explore Research</a>
                            <a href="news.html" class="cta-button secondary">Latest News</a>
                        </div>
                    </div>
                    
                    <!-- Right side: Network Visualization -->
                    <div class="visualization-container">
                        <div class="typing-text" id="typingText"></div>
                        <svg id="network-svg">
                            <defs>
                                <radialGradient id="proteinGradient1" cx="50%" cy="50%" r="50%">
                                    <stop offset="0%" style="stop-color:#a7c4a0;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#6d8b6b;stop-opacity:1" />
                                </radialGradient>
                                <radialGradient id="proteinGradient2" cx="50%" cy="50%" r="50%">
                                    <stop offset="0%" style="stop-color:#9bb896;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#5a7454;stop-opacity:1" />
                                </radialGradient>
                                <radialGradient id="proteinGradient3" cx="50%" cy="50%" r="50%">
                                    <stop offset="0%" style="stop-color:#b8d4b3;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#7a947a;stop-opacity:1" />
                                </radialGradient>
                                <radialGradient id="proteinGradient4" cx="50%" cy="50%" r="50%">
                                    <stop offset="0%" style="stop-color:#8fad8a;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#566852;stop-opacity:1" />
                                </radialGradient>
                                <radialGradient id="proteinGradient5" cx="50%" cy="50%" r="50%">
                                    <stop offset="0%" style="stop-color:#c1d8bd;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#84a07e;stop-opacity:1" />
                                </radialGradient>
                                <radialGradient id="proteinGradient6" cx="50%" cy="50%" r="50%">
                                    <stop offset="0%" style="stop-color:#a5c1a0;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#6e856e;stop-opacity:1" />
                                </radialGradient>
                                <!-- Purple gradient for super-boost -->
                                <radialGradient id="purpleBoostGradient" cx="50%" cy="50%" r="50%">
                                    <stop offset="0%" style="stop-color:#b794f6;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#553c9a;stop-opacity:1" />
                                </radialGradient>
                            </defs>
                        </svg>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Network visualization code
        const svg = document.getElementById('network-svg');
        const width = 500;
        const height = 500;
        
        // Set SVG to be properly responsive
        svg.setAttribute('viewBox', '0 0 500 500');
        svg.setAttribute('preserveAspectRatio', 'xMidYMid meet');
        
        // Define proteins with their properties - back to original size
        const proteins = [
            // Original core nodes with streamlined connections
            { id: 'n1', x: 250, y: 150, size: 35, color: 'url(#proteinGradient1)', connections: ['n2', 'n8', 'n21'] },
            { id: 'n2', x: 400, y: 133, size: 22, color: 'url(#proteinGradient2)', connections: ['n1', 'n4', 'n22'] },
            { id: 'n3', x: 117, y: 183, size: 28, color: 'url(#proteinGradient3)', connections: ['n1', 'n5'] },
            { id: 'n4', x: 433, y: 200, size: 18, color: 'url(#proteinGradient4)', connections: ['n2', 'n6'] },
            { id: 'n5', x: 67, y: 250, size: 32, color: 'url(#proteinGradient5)', connections: ['n3', 'n7'] },
            { id: 'n6', x: 375, y: 267, size: 25, color: 'url(#proteinGradient6)', connections: ['n4', 'n13'] },
            { id: 'n7', x: 150, y: 317, size: 20, color: 'url(#proteinGradient1)', connections: ['n5', 'n12'] },
            { id: 'n8', x: 317, y: 167, size: 24, color: 'url(#proteinGradient2)', connections: ['n1', 'n9'] },
            { id: 'n9', x: 350, y: 233, size: 19, color: 'url(#proteinGradient3)', connections: ['n8', 'n6'] },
            { id: 'n12', x: 100, y: 292, size: 29, color: 'url(#proteinGradient6)', connections: ['n7', 'n19'] },
            { id: 'n13', x: 400, y: 317, size: 23, color: 'url(#proteinGradient1)', connections: ['n6', 'n20'] },
            { id: 'n14', x: 233, y: 350, size: 17, color: 'url(#proteinGradient2)', connections: ['n19', 'n32'] },
            { id: 'n19', x: 200, y: 292, size: 20, color: 'url(#proteinGradient1)', connections: ['n12', 'n14'] },
            { id: 'n20', x: 317, y: 350, size: 24, color: 'url(#proteinGradient2)', connections: ['n13', 'n34'] },
            
            // New strategic nodes with minimal, clean connections
            { id: 'n21', x: 150, y: 67, size: 21, color: 'url(#proteinGradient3)', connections: ['n1', 'n28'] },
            { id: 'n22', x: 450, y: 83, size: 26, color: 'url(#proteinGradient4)', connections: ['n2', 'n24'] },
            { id: 'n23', x: 50, y: 150, size: 19, color: 'url(#proteinGradient5)', connections: ['n3', 'n35'] },
            { id: 'n24', x: 467, y: 150, size: 22, color: 'url(#proteinGradient6)', connections: ['n22', 'n26'] },
            { id: 'n25', x: 33, y: 200, size: 25, color: 'url(#proteinGradient1)', connections: ['n5', 'n23'] },
            { id: 'n26', x: 450, y: 233, size: 20, color: 'url(#proteinGradient2)', connections: ['n24', 'n29'] },
            { id: 'n27', x: 83, y: 367, size: 18, color: 'url(#proteinGradient3)', connections: ['n7', 'n30'] },
            { id: 'n28', x: 300, y: 67, size: 23, color: 'url(#proteinGradient4)', connections: ['n21', 'n22'] },
            { id: 'n29', x: 417, y: 183, size: 17, color: 'url(#proteinGradient5)', connections: ['n26', 'n4'] },
            { id: 'n30', x: 67, y: 333, size: 27, color: 'url(#proteinGradient6)', connections: ['n27', 'n12'] },
            { id: 'n31', x: 433, y: 367, size: 21, color: 'url(#proteinGradient1)', connections: ['n13', 'n34'] },
            { id: 'n32', x: 183, y: 400, size: 16, color: 'url(#proteinGradient2)', connections: ['n14', 'n27'] },
            { id: 'n33', x: 150, y: 250, size: 19, color: 'url(#proteinGradient3)', connections: ['n19', 'n25'] },
            { id: 'n34', x: 367, y: 400, size: 22, color: 'url(#proteinGradient4)', connections: ['n20', 'n31'] },
            
            // Top-left nodes with clean connections
            { id: 'n35', x: 83, y: 83, size: 18, color: 'url(#proteinGradient5)', connections: ['n23', 'n36'] },
            { id: 'n36', x: 33, y: 117, size: 16, color: 'url(#proteinGradient6)', connections: ['n35', 'n25'] }
        ];
        
        // Create connections array
        const connections = [];
        proteins.forEach(protein => {
            protein.connections.forEach(targetId => {
                const target = proteins.find(p => p.id === targetId);
                if (target) {
                    connections.push({
                        source: protein,
                        target: target,
                        id: `${protein.id}-${targetId}`
                    });
                }
            });
        });
        
        // Remove duplicate connections
        const uniqueConnections = connections.filter((conn, index, self) => 
            index === self.findIndex(c => 
                (c.source.id === conn.source.id && c.target.id === conn.target.id) ||
                (c.source.id === conn.target.id && c.target.id === conn.source.id)
            )
        );
        
        // Draw connections with varied sage green colors
        const connectionColors = [
            '#6d8b6b', '#8fad8a', '#a7c4a0', '#b8d4b3', '#5a7454', '#84a07e',
            '#9bb896', '#c1d8bd', '#566852', '#7a947a', '#a5c1a0', '#6e856e'
        ];
        
        uniqueConnections.forEach((conn, index) => {
            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            line.setAttribute('x1', conn.source.x);
            line.setAttribute('y1', conn.source.y);
            line.setAttribute('x2', conn.target.x);
            line.setAttribute('y2', conn.target.y);
            line.setAttribute('stroke', connectionColors[index % connectionColors.length]);
            line.setAttribute('class', 'connection-line');
            line.setAttribute('id', `line-${conn.id}`);
            svg.appendChild(line);
            
            // Create animated particles - reduced quantity
            createParticleAnimation(conn.source, conn.target, connectionColors[index % connectionColors.length], index);
            
            // Add second particle only for select connections (every 3rd connection)
            if (index % 3 === 0) {
                createParticleAnimation(conn.source, conn.target, connectionColors[index % connectionColors.length], index + uniqueConnections.length);
            }
        });
        
        // Draw protein nodes with click functionality
        proteins.forEach(protein => {
            const group = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            group.setAttribute('class', 'protein-node');
            group.style.cursor = 'pointer';
            
            protein.energyLevel = 0;
            protein.clickCount = 0; // Track clicks for this protein
            protein.isPurpleBoosted = false; // Track if this protein has purple boost
            protein.purpleBoostTime = 0; // Track when purple boost was applied
            
            // Add click event listener for interactive energy boost
            group.addEventListener('click', function(e) {
                e.stopPropagation();
                
                // Increase click count and energy
                protein.clickCount++;
                
                // Check if we've reached purple boost threshold (5 clicks)
                if (protein.clickCount >= 5 && !protein.isPurpleBoosted) {
                    protein.isPurpleBoosted = true;
                    protein.purpleBoostTime = Date.now();
                    changeToMagicalColor(protein.id);
                    
                    // Create spectacular purple particle effects
                    createPurpleBoostEffects(protein);
                    
                    // Schedule purple boost removal after 5 seconds
                    setTimeout(() => {
                        protein.isPurpleBoosted = false;
                        protein.clickCount = 0; // Reset click count
                        // Return to normal energy system
                        changeEnergyLevel(protein.id, 0); // This will reset to base color
                    }, 5000);
                    
                } else if (!protein.isPurpleBoosted) {
                    // Regular energy boost (only if not purple boosted)
                    changeEnergyLevel(protein.id, 2);
                    
                    // Add more particles to the system
                    addBonusParticles(protein, protein.clickCount);
                }
                
                // Visual feedback - quick pulse effect
                const allElements = group.querySelectorAll('circle, line');
                allElements.forEach(element => {
                    element.style.transform = 'scale(1.3)';
                    element.style.transformOrigin = `${protein.x}px ${protein.y}px`;
                    setTimeout(() => {
                        element.style.transform = 'scale(1)';
                    }, 200);
                });
            });
            
            const createEnergyFluctuation = () => {
                // Check if purple boost has expired
                if (protein.isPurpleBoosted && (Date.now() - protein.purpleBoostTime > 5000)) {
                    protein.isPurpleBoosted = false;
                    protein.clickCount = 0;
                }
                
                // Don't auto-decrease if purple boosted
                if (!protein.isPurpleBoosted) {
                    const change = Math.random() < 0.5 ? 1 : -1;
                    changeEnergyLevel(protein.id, change);
                }
                setTimeout(createEnergyFluctuation, 8000 + Math.random() * 12000);
            };
            
            setTimeout(createEnergyFluctuation, Math.random() * 5000);
            
            // Outer glow
            const glow = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            glow.setAttribute('cx', protein.x);
            glow.setAttribute('cy', protein.y);
            glow.setAttribute('r', protein.size + 8);
            glow.setAttribute('fill', getEnergyColor(protein.energyLevel));
            glow.setAttribute('opacity', '0.2');
            glow.setAttribute('id', `glow-${protein.id}`);
            group.appendChild(glow);
            
            // Outer plasmid ring
            const outerRing = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            outerRing.setAttribute('cx', protein.x);
            outerRing.setAttribute('cy', protein.y);
            outerRing.setAttribute('r', protein.size);
            outerRing.setAttribute('fill', 'none');
            outerRing.setAttribute('stroke', getEnergyColor(protein.energyLevel));
            outerRing.setAttribute('stroke-width', '4');
            outerRing.setAttribute('opacity', '0.9');
            outerRing.setAttribute('id', `outer-ring-${protein.id}`);
            group.appendChild(outerRing);
            
            // Inner plasmid ring
            const innerRing = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            innerRing.setAttribute('cx', protein.x);
            innerRing.setAttribute('cy', protein.y);
            innerRing.setAttribute('r', protein.size - 8);
            innerRing.setAttribute('fill', 'none');
            innerRing.setAttribute('stroke', getEnergyColor(protein.energyLevel));
            innerRing.setAttribute('stroke-width', '2');
            innerRing.setAttribute('opacity', '0.6');
            innerRing.setAttribute('id', `inner-ring-${protein.id}`);
            group.appendChild(innerRing);
            
            // Center filled circle
            const center = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            center.setAttribute('cx', protein.x);
            center.setAttribute('cy', protein.y);
            center.setAttribute('r', '6');
            center.setAttribute('fill', getEnergyColor(protein.energyLevel));
            center.setAttribute('opacity', '0.8');
            center.setAttribute('id', `center-${protein.id}`);
            group.appendChild(center);
            
            // Add restriction sites
            for (let i = 0; i < 4; i++) {
                const angle = (i * 90) * Math.PI / 180;
                const x1 = protein.x + (protein.size - 2) * Math.cos(angle);
                const y1 = protein.y + (protein.size - 2) * Math.sin(angle);
                const x2 = protein.x + (protein.size + 2) * Math.cos(angle);
                const y2 = protein.y + (protein.size + 2) * Math.sin(angle);
                
                const site = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                site.setAttribute('x1', x1);
                site.setAttribute('y1', y1);
                site.setAttribute('x2', x2);
                site.setAttribute('y2', y2);
                site.setAttribute('stroke', getEnergyColor(protein.energyLevel));
                site.setAttribute('stroke-width', '2');
                site.setAttribute('opacity', '0.7');
                site.setAttribute('class', `restriction-${protein.id}`);
                group.appendChild(site);
            }
            
            // Add animations
            const animateRotate = document.createElementNS('http://www.w3.org/2000/svg', 'animateTransform');
            animateRotate.setAttribute('attributeName', 'transform');
            animateRotate.setAttribute('type', 'rotate');
            animateRotate.setAttribute('values', `0 ${protein.x} ${protein.y};360 ${protein.x} ${protein.y}`);
            animateRotate.setAttribute('dur', '8s');
            animateRotate.setAttribute('repeatCount', 'indefinite');
            outerRing.appendChild(animateRotate);
            
            const animate = document.createElementNS('http://www.w3.org/2000/svg', 'animate');
            animate.setAttribute('attributeName', 'r');
            animate.setAttribute('values', '6;8;6');
            animate.setAttribute('dur', '3s');
            animate.setAttribute('repeatCount', 'indefinite');
            animate.setAttribute('begin', `${Math.random() * 2}s`);
            center.appendChild(animate);
            
            svg.appendChild(group);
        });
        
        function createParticleAnimation(source, target, color, delay) {
            const particle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            particle.setAttribute('class', 'pulse-particle');
            particle.setAttribute('fill', color);
            particle.setAttribute('r', '4');
            
            const animateX = document.createElementNS('http://www.w3.org/2000/svg', 'animate');
            animateX.setAttribute('attributeName', 'cx');
            animateX.setAttribute('values', `${source.x};${target.x}`);
            animateX.setAttribute('dur', '4s');
            animateX.setAttribute('repeatCount', 'indefinite');
            animateX.setAttribute('begin', `${delay * 0.5}s`);
            
            const animateY = document.createElementNS('http://www.w3.org/2000/svg', 'animate');
            animateY.setAttribute('attributeName', 'cy');
            animateY.setAttribute('values', `${source.y};${target.y}`);
            animateY.setAttribute('dur', '4s');
            animateY.setAttribute('repeatCount', 'indefinite');
            animateY.setAttribute('begin', `${delay * 0.5}s`);
            
            const animateOpacity = document.createElementNS('http://www.w3.org/2000/svg', 'animate');
            animateOpacity.setAttribute('attributeName', 'opacity');
            animateOpacity.setAttribute('values', '0;1;1;0');
            animateOpacity.setAttribute('dur', '4s');
            animateOpacity.setAttribute('repeatCount', 'indefinite');
            animateOpacity.setAttribute('begin', `${delay * 0.5}s`);
            
            particle.appendChild(animateX);
            particle.appendChild(animateY);
            particle.appendChild(animateOpacity);
            
            svg.appendChild(particle);
        }
        
        function changeEnergyLevel(proteinId, change) {
            const protein = proteins.find(p => p.id === proteinId);
            if (!protein) return;
            
            // If purple boosted, don't change energy until boost expires
            if (protein.isPurpleBoosted) return;
            
            protein.energyLevel = Math.max(-3, Math.min(5, protein.energyLevel + change));
            const newColor = getEnergyColor(protein.energyLevel);
            
            const outerRing = document.querySelector(`#outer-ring-${proteinId}`);
            const innerRing = document.querySelector(`#inner-ring-${proteinId}`);
            const center = document.querySelector(`#center-${proteinId}`);
            const glow = document.querySelector(`#glow-${proteinId}`);
            const restrictions = document.querySelectorAll(`.restriction-${proteinId}`);
            
            if (outerRing) outerRing.setAttribute('stroke', newColor);
            if (innerRing) innerRing.setAttribute('stroke', newColor);
            if (center) center.setAttribute('fill', newColor);
            if (glow) glow.setAttribute('fill', newColor);
            restrictions.forEach(site => site.setAttribute('stroke', newColor));
        }
        
        function changeToMagicalColor(proteinId) {
            const protein = proteins.find(p => p.id === proteinId);
            if (!protein) return;
            
            // Purple colors for the magical boost
            const purpleColor = '#9f7aea'; // Beautiful purple
            const darkPurple = '#553c9a';
            
            const outerRing = document.querySelector(`#outer-ring-${proteinId}`);
            const innerRing = document.querySelector(`#inner-ring-${proteinId}`);
            const center = document.querySelector(`#center-${proteinId}`);
            const glow = document.querySelector(`#glow-${proteinId}`);
            const restrictions = document.querySelectorAll(`.restriction-${proteinId}`);
            
            if (outerRing) outerRing.setAttribute('stroke', purpleColor);
            if (innerRing) innerRing.setAttribute('stroke', purpleColor);
            if (center) center.setAttribute('fill', darkPurple);
            if (glow) glow.setAttribute('fill', purpleColor);
            restrictions.forEach(site => site.setAttribute('stroke', purpleColor));
        }
        
        function getEnergyColor(energyLevel) {
            const colors = [
                '#f8faf8', '#e6f0e6', '#c8d6c8', '#a7c4a0', '#9bb8c4',
                '#7a9db4', '#5f7a8a', '#4a6570', '#3d5560'
            ];
            const index = energyLevel + 3;
            return colors[Math.max(0, Math.min(8, index))];
        }
        
        function addBonusParticles(sourceProtein, clickCount) {
            const particleCount = Math.min(clickCount, 5); // Max 5 bonus particles
            
            // Add particles to all connected nodes
            sourceProtein.connections.forEach(targetId => {
                const targetProtein = proteins.find(p => p.id === targetId);
                if (targetProtein) {
                    for (let i = 0; i < particleCount; i++) {
                        createBonusParticle(sourceProtein, targetProtein, i * 0.3);
                    }
                }
            });
            
            // Add some random orbital particles around the clicked protein
            for (let i = 0; i < particleCount; i++) {
                createOrbitalParticle(sourceProtein, i);
            }
        }
        
        function createPurpleBoostEffects(sourceProtein) {
            // Create spectacular purple particle burst
            for (let i = 0; i < 12; i++) {
                createPurpleSparkle(sourceProtein, i);
            }
            
            // Create purple waves to all connected nodes
            sourceProtein.connections.forEach((targetId, index) => {
                const targetProtein = proteins.find(p => p.id === targetId);
                if (targetProtein) {
                    for (let i = 0; i < 3; i++) {
                        createPurpleWave(sourceProtein, targetProtein, i * 0.2);
                    }
                }
            });
            
            // Create magical orbital ring
            createMagicalRing(sourceProtein);
        }
        
        function createPurpleSparkle(centerProtein, index) {
            const particle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            particle.setAttribute('class', 'purple-sparkle');
            particle.setAttribute('fill', '#b794f6');
            particle.setAttribute('r', '3');
            particle.setAttribute('opacity', '0');
            
            const angle = (index * 30) * Math.PI / 180; // 12 particles in circle
            const distance = 60;
            const endX = centerProtein.x + distance * Math.cos(angle);
            const endY = centerProtein.y + distance * Math.sin(angle);
            
            const animateX = document.createElementNS('http://www.w3.org/2000/svg', 'animate');
            animateX.setAttribute('attributeName', 'cx');
            animateX.setAttribute('values', `${centerProtein.x};${endX}`);
            animateX.setAttribute('dur', '1.5s');
            animateX.setAttribute('fill', 'remove');
            
            const animateY = document.createElementNS('http://www.w3.org/2000/svg', 'animate');
            animateY.setAttribute('attributeName', 'cy');
            animateY.setAttribute('values', `${centerProtein.y};${endY}`);
            animateY.setAttribute('dur', '1.5s');
            animateY.setAttribute('fill', 'remove');
            
            const animateOpacity = document.createElementNS('http://www.w3.org/2000/svg', 'animate');
            animateOpacity.setAttribute('attributeName', 'opacity');
            animateOpacity.setAttribute('values', '0;1;0');
            animateOpacity.setAttribute('dur', '1.5s');
            animateOpacity.setAttribute('fill', 'remove');
            
            particle.appendChild(animateX);
            particle.appendChild(animateY);
            particle.appendChild(animateOpacity);
            
            svg.appendChild(particle);
            
            setTimeout(() => {
                if (particle.parentNode) {
                    particle.parentNode.removeChild(particle);
                }
            }, 1600);
        }
        
        function createPurpleWave(source, target, delay) {
            const particle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            particle.setAttribute('class', 'purple-wave');
            particle.setAttribute('fill', '#9f7aea');
            particle.setAttribute('r', '4');
            particle.setAttribute('opacity', '0');
            
            const animateX = document.createElementNS('http://www.w3.org/2000/svg', 'animate');
            animateX.setAttribute('attributeName', 'cx');
            animateX.setAttribute('values', `${source.x};${target.x}`);
            animateX.setAttribute('dur', '1s');
            animateX.setAttribute('begin', `${delay}s`);
            animateX.setAttribute('fill', 'remove');
            
            const animateY = document.createElementNS('http://www.w3.org/2000/svg', 'animate');
            animateY.setAttribute('attributeName', 'cy');
            animateY.setAttribute('values', `${source.y};${target.y}`);
            animateY.setAttribute('dur', '1s');
            animateY.setAttribute('begin', `${delay}s`);
            animateY.setAttribute('fill', 'remove');
            
            const animateOpacity = document.createElementNS('http://www.w3.org/2000/svg', 'animate');
            animateOpacity.setAttribute('attributeName', 'opacity');
            animateOpacity.setAttribute('values', '0;0.9;0');
            animateOpacity.setAttribute('dur', '1s');
            animateOpacity.setAttribute('begin', `${delay}s`);
            animateOpacity.setAttribute('fill', 'remove');
            
            particle.appendChild(animateX);
            particle.appendChild(animateY);
            particle.appendChild(animateOpacity);
            
            svg.appendChild(particle);
            
            setTimeout(() => {
                if (particle.parentNode) {
                    particle.parentNode.removeChild(particle);
                }
            }, (delay + 1) * 1000 + 100);
        }
        
        function createMagicalRing(centerProtein) {
            const ring = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            ring.setAttribute('class', 'magical-ring');
            ring.setAttribute('cx', centerProtein.x);
            ring.setAttribute('cy', centerProtein.y);
            ring.setAttribute('r', centerProtein.size + 20);
            ring.setAttribute('fill', 'none');
            ring.setAttribute('stroke', '#b794f6');
            ring.setAttribute('stroke-width', '3');
            ring.setAttribute('opacity', '0');
            
            const animateOpacity = document.createElementNS('http://www.w3.org/2000/svg', 'animate');
            animateOpacity.setAttribute('attributeName', 'opacity');
            animateOpacity.setAttribute('values', '0;0.8;0');
            animateOpacity.setAttribute('dur', '2s');
            animateOpacity.setAttribute('fill', 'remove');
            
            const animateRadius = document.createElementNS('http://www.w3.org/2000/svg', 'animate');
            animateRadius.setAttribute('attributeName', 'r');
            animateRadius.setAttribute('values', `${centerProtein.size + 20};${centerProtein.size + 50}`);
            animateRadius.setAttribute('dur', '2s');
            animateRadius.setAttribute('fill', 'remove');
            
            ring.appendChild(animateOpacity);
            ring.appendChild(animateRadius);
            
            svg.appendChild(ring);
            
            setTimeout(() => {
                if (ring.parentNode) {
                    ring.parentNode.removeChild(ring);
                }
            }, 2100);
        }
        
        function createBonusParticle(source, target, delay) {
            const particle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            particle.setAttribute('class', 'bonus-particle');
            particle.setAttribute('fill', getEnergyColor(source.energyLevel));
            particle.setAttribute('r', '3');
            particle.setAttribute('opacity', '0');
            
            const animateX = document.createElementNS('http://www.w3.org/2000/svg', 'animate');
            animateX.setAttribute('attributeName', 'cx');
            animateX.setAttribute('values', `${source.x};${target.x}`);
            animateX.setAttribute('dur', '1.5s');
            animateX.setAttribute('begin', `${delay}s`);
            animateX.setAttribute('fill', 'remove');
            
            const animateY = document.createElementNS('http://www.w3.org/2000/svg', 'animate');
            animateY.setAttribute('attributeName', 'cy');
            animateY.setAttribute('values', `${source.y};${target.y}`);
            animateY.setAttribute('dur', '1.5s');
            animateY.setAttribute('begin', `${delay}s`);
            animateY.setAttribute('fill', 'remove');
            
            const animateOpacity = document.createElementNS('http://www.w3.org/2000/svg', 'animate');
            animateOpacity.setAttribute('attributeName', 'opacity');
            animateOpacity.setAttribute('values', '0;1;0');
            animateOpacity.setAttribute('dur', '1.5s');
            animateOpacity.setAttribute('begin', `${delay}s`);
            animateOpacity.setAttribute('fill', 'remove');
            
            particle.appendChild(animateX);
            particle.appendChild(animateY);
            particle.appendChild(animateOpacity);
            
            svg.appendChild(particle);
            
            setTimeout(() => {
                if (particle.parentNode) {
                    particle.parentNode.removeChild(particle);
                }
            }, (delay + 1.5) * 1000 + 100);
        }
        
        function createOrbitalParticle(centerProtein, index) {
            const particle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            particle.setAttribute('class', 'orbital-particle');
            particle.setAttribute('fill', getEnergyColor(centerProtein.energyLevel + 2));
            particle.setAttribute('r', '2');
            particle.setAttribute('opacity', '0.8');
            
            const radius = centerProtein.size + 15 + (index * 5);
            const startAngle = index * 60;
            
            const animateX = document.createElementNS('http://www.w3.org/2000/svg', 'animateTransform');
            animateX.setAttribute('attributeName', 'transform');
            animateX.setAttribute('type', 'rotate');
            animateX.setAttribute('values', `${startAngle} ${centerProtein.x} ${centerProtein.y};${startAngle + 360} ${centerProtein.x} ${centerProtein.y}`);
            animateX.setAttribute('dur', '3s');
            animateX.setAttribute('repeatCount', '2');
            
            const animateOpacity = document.createElementNS('http://www.w3.org/2000/svg', 'animate');
            animateOpacity.setAttribute('attributeName', 'opacity');
            animateOpacity.setAttribute('values', '0;0.8;0.8;0');
            animateOpacity.setAttribute('dur', '6s');
            
            particle.setAttribute('cx', centerProtein.x + radius * Math.cos(startAngle * Math.PI / 180));
            particle.setAttribute('cy', centerProtein.y + radius * Math.sin(startAngle * Math.PI / 180));
            
            particle.appendChild(animateX);
            particle.appendChild(animateOpacity);
            
            svg.appendChild(particle);
            
            setTimeout(() => {
                if (particle.parentNode) {
                    particle.parentNode.removeChild(particle);
                }
            }, 6100);
        }
        
        // Typing animation
        const typingElement = document.getElementById('typingText');
        const phrases = [
            'Sustainable Biomanufacturing', 'Synthetic Biology', 'Protein Engineering',
            'Metabolic Flux', 'Plastic Upcycling', 'Gene Editing', 'Metabolic Burden',
            'Microbial Stress Response', 'Microbial Networks', 'Media Optimization',
            'Genetic Stability', 'Resource Allocation', 'Polymer Degradation',
            'Redox Management', 'Metabolite Characterization', 'Multi-enzyme Regulation',
            'Resource Circularity', 'Bioengineering', 'Pathway Optimization',
            'Environmental Sustainability'
        ];
        
        let currentPhraseIndex = 0;
        let currentCharIndex = 0;
        let isDeleting = false;
        let typingSpeed = 100;
        
        function typeText() {
            const currentPhrase = phrases[currentPhraseIndex];
            
            if (isDeleting) {
                typingElement.textContent = currentPhrase.substring(0, currentCharIndex - 1) + '|';
                currentCharIndex--;
                typingSpeed = 50;
                
                if (currentCharIndex === 0) {
                    isDeleting = false;
                    currentPhraseIndex = (currentPhraseIndex + 1) % phrases.length;
                    typingSpeed = 500;
                }
            } else {
                typingElement.textContent = currentPhrase.substring(0, currentCharIndex + 1) + '|';
                currentCharIndex++;
                typingSpeed = 100;
                
                if (currentCharIndex === currentPhrase.length) {
                    typingSpeed = 3000;
                    isDeleting = true;
                }
            }
            
            setTimeout(typeText, typingSpeed);
        }
        
        setTimeout(typeText, 1000);
        
        // Add hover effects
        document.querySelectorAll('.protein-node').forEach(node => {
            node.addEventListener('mouseenter', function() {
                this.style.transform = 'scale(1.1)';
                this.style.transformOrigin = 'center';
            });
            
            node.addEventListener('mouseleave', function() {
                this.style.transform = 'scale(1)';
            });
        });

        // Rest of your existing JavaScript
        document.getElementById('mobileToggle')?.addEventListener('click', function() {
            const navMenu = document.getElementById('navMenu');
            navMenu?.classList.toggle('active');
        });
    </script>
</body>
</html>
